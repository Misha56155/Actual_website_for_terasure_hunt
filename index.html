<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Treasure Hunt – Code Checker</title>
  <style>
    :root{
      --bg:#0f172a;--card:#111827;--accent:#22c55e;--accent-2:#16a34a;--text:#e5e7eb;--muted:#94a3b8;--shadow:0 20px 40px rgba(0,0,0,.35);--radius:18px
    }
    *{box-sizing:border-box}html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";background:radial-gradient(1000px 600px at 20% -10%,#1f2937 0,transparent 60%),radial-gradient(1000px 600px at 120% 110%,#1f2937 0,transparent 60%),var(--bg);color:var(--text);display:grid;place-items:center;padding:24px}
    .card{width:min(520px,100%);background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.06);border-radius:var(--radius);box-shadow:var(--shadow);padding:28px;backdrop-filter:blur(6px)}
    h1{margin:0 0 8px;font-size:clamp(22px,2.4vw,28px);letter-spacing:.2px}
    p.lead{margin:0 0 18px;color:var(--muted)}
    form{display:grid;gap:14px}
    .field{display:grid;gap:10px}
    label{font-size:14px;color:var(--muted)}
    .input-row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
    input[type="text"]{width:100%;padding:14px 16px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0b1220;color:var(--text);letter-spacing:2px;font-size:18px;font-variant-numeric:tabular-nums;outline:none;transition:border-color .2s,box-shadow .2s}
    input[type="text"]:focus{border-color:rgba(34,197,94,.6);box-shadow:0 0 0 4px rgba(34,197,94,.15)}
    button[type="submit"]{appearance:none;border:none;padding:14px 18px;border-radius:12px;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#00130a;font-weight:700;letter-spacing:.3px;cursor:pointer;transition:transform .04s,filter .2s,opacity .2s}
    button[type="submit"]:hover{filter:brightness(1.05)}button[type="submit"]:active{transform:translateY(1px)}button[disabled]{opacity:.6;cursor:not-allowed}
    .status{min-height:46px;padding:12px 14px;border-radius:12px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);display:grid;align-items:center;color:var(--muted)}
    .status.success{color:#052e1a;background:rgba(34,197,94,.18);border-color:rgba(34,197,94,.35)}
    .status.error{color:#3f0a0a;background:rgba(239,68,68,.18);border-color:rgba(239,68,68,.35)}
    .status.warn{color:#2d2203;background:rgba(245,158,11,.2);border-color:rgba(245,158,11,.35)}
    .helper{font-size:12px;color:var(--muted);margin-top:6px}
    .tiny{font-size:12px;color:var(--muted);text-align:center;margin-top:18px}
  </style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="title">
    <h1 id="title">Enter your code</h1>

    <form id="code-form" novalidate>
      <div class="field">
        <div class="input-row">
          <input id="code" name="code" type="text" inputmode="numeric" autocomplete="one-time-code"
                 pattern="\d{7}" maxlength="7" placeholder="•••••••" aria-describedby="hint"
                 aria-required="true" aria-invalid="false" />
          <button type="submit" id="submit">Check</button>
        </div>
      </div>

    </form>
  </main>

  <script>
    // Your API endpoint on Render
    const API_URL = 'https://treasure-hunt-website.onrender.com/check';

    const form = document.getElementById('code-form');
    const codeInput = document.getElementById('code');
    const submitBtn = document.getElementById('submit');
    const statusBox = document.getElementById('status');

    // Keep input strictly numeric and max 7 chars
    codeInput.addEventListener('input', () => {
      const digits = codeInput.value.replace(/\D/g, '').slice(0, 7);
      codeInput.value = digits;
      codeInput.setAttribute('aria-invalid', String(!(digits.length === 7) || !(digits.length === 6)));
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const code = (codeInput.value || '').trim();

      if (!/^\d{7}$/.test(code)) {
        showStatus('Please enter exactly 7 digits.', 'error');
        codeInput.focus();
        return;
      }

      setLoading(true);
      showStatus('Checking your code…', '');

      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ code })
        });

        if (res.status === 429) {
          showStatus('Too many attempts — please wait a minute and try again.', 'warn');
          return;
        }

        if (!res.ok) {
          showStatus('Server error. Try again shortly.', 'error');
          return;
        }

        const contentType = res.headers.get('content-type') || '';
        if (!contentType.includes('application/json')) {
          showStatus('Unexpected response from server.', 'error');
          return;
        }

        const data = await res.json();
        if (data && data.ok) {
          showStatus(data.message || 'Success!', 'success');
          codeInput.value = '';
        } else if (data && data.reason === 'bad_format') {
          showStatus('Invalid format — need exactly seven digits.', 'error');
        } else {
          showStatus('Nope, that code is incorrect. Try again!', 'error');
        }
      } catch (err) {
        showStatus('Network error — check your connection and try again.', 'error');
      } finally {
        setLoading(false);
      }
    });

    function setLoading(state){ submitBtn.disabled = state; codeInput.readOnly = state; }
    function showStatus(msg, kind){ statusBox.textContent = msg; statusBox.className = 'status' + (kind ? ' ' + kind : ''); }
    window.addEventListener('DOMContentLoaded', () => codeInput.focus());
  </script>
</body>
</html>
