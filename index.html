<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Treasure Hunt – Code Checker</title>
  <style>
    :root {
      --bg: #0f172a;          /* slate-900 */
      --card: #111827;        /* gray-900 */
      --accent: #22c55e;      /* green-500 */
      --accent-2: #16a34a;    /* green-600 */
      --text: #e5e7eb;        /* gray-200 */
      --muted: #94a3b8;       /* slate-400 */
      --danger: #ef4444;      /* red-500 */
      --warning: #f59e0b;     /* amber-500 */
      --shadow: 0 20px 40px rgba(0,0,0,.35);
      --radius: 18px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1000px 600px at 20% -10%, #1f2937 0, transparent 60%),
                  radial-gradient(1000px 600px at 120% 110%, #1f2937 0, transparent 60%),
                  var(--bg);
      color: var(--text);
      display: grid; place-items: center;
      padding: 24px;
    }

    .card {
      width: min(520px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 28px;
      backdrop-filter: blur(6px);
      transform: translateZ(0);
    }

    h1 {
      margin: 0 0 8px;
      font-size: clamp(22px, 2.4vw, 28px);
      letter-spacing: 0.2px;
    }
    p.lead { margin: 0 0 18px; color: var(--muted); }

    form { display: grid; gap: 14px; }

    .field {
      display: grid;
      gap: 10px;
    }

    label { font-size: 14px; color: var(--muted); }

    .input-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
    }

    input[type="text"] {
      width: 100%;
      padding: 14px 16px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: #0b1220;
      color: var(--text);
      letter-spacing: 2px;
      font-size: 18px;
      font-variant-numeric: tabular-nums;
      outline: none;
      transition: border-color .2s ease, box-shadow .2s ease;
    }
    input[type="text"]:focus {
      border-color: rgba(34,197,94,.6);
      box-shadow: 0 0 0 4px rgba(34,197,94,.15);
    }

    button[type="submit"] {
      appearance: none;
      border: none;
      padding: 14px 18px;
      border-radius: 12px;
      background: linear-gradient(180deg, var(--accent), var(--accent-2));
      color: #00130a;
      font-weight: 700;
      letter-spacing: .3px;
      cursor: pointer;
      transition: transform .04s ease, filter .2s ease, opacity .2s ease;
    }
    button[type="submit"]:hover { filter: brightness(1.05); }
    button[type="submit"]:active { transform: translateY(1px); }
    button[disabled] { opacity: .6; cursor: not-allowed; }

    .status {
      min-height: 46px;
      padding: 12px 14px;
      border-radius: 12px;
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.06);
      display: grid; align-items: center;
      color: var(--muted);
    }

    .status.success {
      color: #052e1a;
      background: rgba(34,197,94,.18);
      border-color: rgba(34,197,94,.35);
    }
    .status.error {
      color: #3f0a0a;
      background: rgba(239,68,68,.18);
      border-color: rgba(239,68,68,.35);
      animation: shake .3s ease;
    }
    .status.warn {
      color: #2d2203;
      background: rgba(245,158,11,.2);
      border-color: rgba(245,158,11,.35);
    }

    @keyframes shake {
      10%, 90% { transform: translateX(-1px); }
      20%, 80% { transform: translateX(2px); }
      30%, 50%, 70% { transform: translateX(-4px); }
      40%, 60% { transform: translateX(4px); }
    }

    .helper { font-size: 12px; color: var(--muted); margin-top: 6px; }
    .tiny { font-size: 12px; color: var(--muted); text-align: center; margin-top: 18px; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0; }
  </style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="title">
    <h1 id="title">Enter your 7‑digit code</h1>

    <form id="code-form" novalidate>
      <div class="field">
        <label for="code">7‑digit code</label>
        <div class="input-row">
          <input id="code" name="code" type="text" inputmode="numeric" autocomplete="one-time-code"
                 aria-required="true" aria-invalid="false" />
          <button type="submit" id="submit">Check</button>
      </div>

      <div id="status" class="status" aria-live="polite">Waiting for your code…</div>
      <div class="tiny">Having trouble? Check your connection or try again in a minute.</div>
    </form>
  </main>

  <script>
    // 1) CHANGE THIS to your Render URL
    const API_URL = 'https://treasure-hunt-website.onrender.com';

    const form = document.getElementById('code-form');
    const codeInput = document.getElementById('code');
    const submitBtn = document.getElementById('submit');
    const statusBox = document.getElementById('status');

    // Keep input strictly numeric and max 7 chars
    codeInput.addEventListener('input', () => {
      const digits = codeInput.value.replace(/\D/g, '').slice(0, 8);
      codeInput.value = digits;
      codeInput.setAttribute('aria-invalid', String(!(digits.length >= 6)));
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const code = (codeInput.value || '').trim();

      if (!/^\d{6}$/.test(code)) {
        showStatus('Please enter exactly 7 digits.', 'error');
        codeInput.focus();
        return;
      }

      setLoading(true);
      showStatus('Checking your code…', '');

      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ code })
        });

        // Rate-limited
        if (res.status === 429) {
          showStatus('Too many attempts — please wait a minute and try again.', 'warn');
          return;
        }

        if (!res.ok) {
          const text = await res.text();
          showStatus('Server error. Try again shortly.', 'error');
          console.debug('Non-OK response:', res.status, text);
          return;
        }

        const contentType = res.headers.get('content-type') || '';
        if (!contentType.includes('application/json')) {
          const text = await res.text();
          showStatus('Unexpected response from server.', 'error');
          console.debug('Unexpected content-type:', contentType, text);
          return;
        }

        const data = await res.json();
        if (data && data.ok) {
          showStatus(data.message || 'Success!', 'success');
          // Optional: clear for next step
          codeInput.value = '';
        } else if (data && data.reason === 'bad_format') {
          showStatus('Invalid format — need exactly six digits.', 'error');
        } else {
          showStatus('Nope, that code is incorrect. Try again!', 'error');
        }
      } catch (err) {
        console.error(err);
        showStatus('Network error — check your connection and try again.', 'error');
      } finally {
        setLoading(false);
      }
    });

    function setLoading(state) {
      submitBtn.disabled = state;
      codeInput.readOnly = state;
    }

    function showStatus(msg, kind) {
      statusBox.textContent = msg;
      statusBox.classList.remove('success', 'error', 'warn');
      if (kind) statusBox.classList.add(kind);
    }

    // Focus field on load
    window.addEventListener('DOMContentLoaded', () => codeInput.focus());
  </script>
</body>
</html>
