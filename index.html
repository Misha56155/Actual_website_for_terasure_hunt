<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Treasure Code Checker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { font-family: system-ui, sans-serif; }
    body { display:grid; place-items:center; min-height:100dvh; margin:0; background:#0f172a; color:#0f172a; }
    .card { width:min(680px, 92vw); background:#111827; border:1px solid #334155; border-radius:16px; padding:24px; box-shadow:0 10px 30px rgba(0,0,0,.35); }
    h1 { margin:0 0 8px; font-size:1.25rem; }
    p.hint { margin:0 0 16px; color:#94a3b8; }
    form { display:flex; gap:12px; }
    input[type="text"]{
      flex:1; padding:14px 16px; font-size:1.05rem; border-radius:12px; border:1px solid #334155;
      background:#0b1220; color:#1e293b; outline:none;
    }
    input::placeholder{ color:#64748b; }
    button{
      padding:14px 18px; font-weight:600; border-radius:12px; border:1px solid #334155; background:#1e293b; color:#e2e8f0; cursor:pointer;
    }
    button[disabled]{ opacity:.6; cursor:not-allowed; }
    .out { margin-top:16px; padding:14px; border-radius:12px; background:#0b1220; border:1px solid #334155; min-height:3.25em; }
    .ok { color:#86efac; }
    .err { color:#fca5a5; }
    .muted { color:#94a3b8; }
    .row { display:flex; gap:8px; align-items:center; margin-top:8px; }
    .small { font-size:.9rem; }
    code { background:#0b1220; padding:2px 6px; border-radius:6px; border:1px solid #334155; }
  </style>
</head>
<body>
  <div class="card">
    <h1>7 Numbers</h1>

    <form id="form" autocomplete="off" novalidate>
      <input id="code" name="code" type="text" inputmode="numeric" pattern="\\d{6,7}"
             placeholder="e.g. 123456 or 1234567" maxlength="7" required />
      <button id="btn" type="submit">Check</button>
    </form>

    <div id="out" class="out muted">Give me your seed</div>


    </div>
  </div>

  <script>
    // ⬇️ Point this to your API. If you previously used `/api/check`,
    // either change it here to '/check' OR update your Flask route to '/api/check'.
    const API_URL = 'https://treasure-hunt-website.onrender.com/check';
    // Example if your site & API share the same hostname path prefix:
    // const API_URL = '/check';

    const form = document.getElementById('form');
    const codeEl = document.getElementById('code');
    const btn = document.getElementById('btn');
    const out = document.getElementById('out');

    function show(msg, cls='muted'){
      out.className = 'out ' + cls;
      out.textContent = msg;
    }

    function isSixOrSevenDigits(s){
      return /^\d{6,7}$/.test(s);
    }

    async function checkCode(code){
      btn.disabled = true;
      show('Checking…');
      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ code })
        });

        // 429 (rate-limited) can come back from your server.
        // It may also reply 200 with ok:false and optional reason.
        const data = await res.json().catch(() => ({}));

        if (res.status === 429 || data.reason === 'rate_limited') {
          show('Too many attempts. Try again shortly.', 'err');
          return;
        }

        if (data.ok && data.message){
          show(data.message, 'ok');
        } else if (data.reason === 'bad_format'){
          show('That code format is invalid.', 'err');
        } else {
          show('Wrong.', 'err');
        }
      } catch (e) {
        show('Network error contacting the server.', 'err');
      } finally {
        btn.disabled = false;
      }
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const code = codeEl.value.trim();
      if (!isSixOrSevenDigits(code)){
        show('Wrong.', 'err');
        codeEl.focus();
        return;
      }
      checkCode(code);
    });

    // Auto-check if ?code=123456 is present
    const params = new URLSearchParams(location.search);
    const preset = (params.get('code') || '').trim();
    if (isSixOrSevenDigits(preset)){
      codeEl.value = preset;
      checkCode(preset);
    }
  </script>
</body>
</html>
